{
  "title": "Displaying Aranet4 CO2 readings on my website",
  "publishedAt": "2024-01-07",
  "image": {
    "src": "/static/images/co2-monitor.jpg",
    "alt": "Screenshot showing readings of my CO2 monitor",
    "width": 1348,
    "height": 642,
    "showAsHeader": false
  },
  "summary": "Tutorial on how to display real-time CO2 measurements from an Aranet4 monitor on my website using a Raspberry Pi.",
  "tags": [
    "side-project",
    "python",
    "nextjs"
  ],
  "tagsAsSlugs": [
    "side-project",
    "python",
    "nextjs"
  ],
  "slug": "aranet4-co2-monitor",
  "code": "var Component=(()=>{var h=Object.create;var t=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),y=(a,n)=>{for(var s in n)t(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,l)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of u(n))!k.call(a,c)&&c!==s&&t(a,c,{get:()=>n[c],enumerable:!(l=m(n,c))||l.enumerable});return a};var f=(a,n,s)=>(s=a!=null?h(N(a)):{},i(n||!a||!a.__esModule?t(s,\"default\",{value:a,enumerable:!0}):s,a)),b=a=>i(t({},\"__esModule\",{value:!0}),a);var r=g((I,o)=>{o.exports=_jsx_runtime});var E={};y(E,{default:()=>d,frontmatter:()=>w});var e=f(r()),w={title:\"Displaying Aranet4 CO2 readings on my website\",publishedAt:\"2024-01-07\",image:{src:\"/static/images/co2-monitor.jpg\",alt:\"Screenshot showing readings of my CO2 monitor\",width:1348,height:642,showAsHeader:!1},summary:\"Tutorial on how to display real-time CO2 measurements from an Aranet4 monitor on my website using a Raspberry Pi.\",tags:[\"side-project\",\"python\",\"nextjs\"]};function p(a){let n={a:\"a\",code:\"code\",h2:\"h2\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...a.components},{Co2Monitor:s}=n;return s||A(\"Co2Monitor\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"I recently got an Aranet4 Co\",(0,e.jsx)(\"sub\",{children:\"2\"}),\" monitor and it's a delightful little gadget. It's small and simple and after inserting the 2 AA batteries I could immediately see the CO\",(0,e.jsx)(\"sub\",{children:\"2\"}),\" levels on a clear little screen. I've \",(0,e.jsx)(n.a,{href:\"https://twitter.com/PJUllrich/status/1737484637293711647\",children:\"been told\"}),\" it's also one of the most accurate monitors on the market. Using an unofficial Python library and my Raspberry Pi I was also able to show the measurements on my website. You can \",(0,e.jsx)(n.a,{href:\"/blog/aranet4-co2-monitor#result\",children:\"skip to the end\"}),\" to see the result. Follow along if you're interested in doing something similar yourself.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"requirements\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#requirements\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Requirements\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The setup I'm using involves the following:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"an \",(0,e.jsx)(n.a,{href:\"https://aranet.com/products/aranet4/\",children:\"Aranet4\"}),\" CO\",(0,e.jsx)(\"sub\",{children:\"2\"}),\" monitor\"]}),`\n`,(0,e.jsx)(n.li,{children:\"a Raspberry Pi\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"a PostgreSQL database - I'm using \",(0,e.jsx)(n.a,{href:\"https://supabase.com/\",children:\"Supabase\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"a Next.JS website\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"getting-started\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#getting-started\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Getting started\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Install the following packages on your Raspberry Pi:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sh\",children:(0,e.jsx)(n.code,{className:\"language-sh code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` bluetooth pi-bluetooth bluez blueman\n`]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Then use \",(0,e.jsx)(n.code,{children:\"bluetoothctl\"}),\" to pair with your Aranet4:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sh\",children:(0,e.jsxs)(n.code,{className:\"language-sh code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` bluetoothctl\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` scan on\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" pair \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$MAC\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` scan off\n`]})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"python-script\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#python-script\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Python script\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I adapted the Python script I found on \",(0,e.jsx)(n.a,{href:\"https://www.furidamu.org/blog/2023/03/04/saving-aranet4-data-to-raspberry-pi/\",children:\"this blog\"}),\" to get the current measurements of my Aranet4 monitor. I\\u2019m storing the data in a PostgreSQL database (hosted on Supabase) so that I can easily access it on my website. First, install the Python libraries \",(0,e.jsx)(n.a,{href:\"https://github.com/Anrijs/Aranet4-Python\",children:\"aranet4\"}),\" and \",(0,e.jsx)(n.code,{children:\"psycopg2\"}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sh\",children:(0,e.jsx)(n.code,{className:\"language-sh code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pip \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` aranet4 psycopg2\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"Then I use the following Python script to store the latest measurement in a PostgreSQL database:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` configparser\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` time\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` aranet4\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` psycopg2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" datetime \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` datetime\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"BASE_DIR \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dirname\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"abspath\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"__file__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" configparser\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"ConfigParser\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"join\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"BASE_DIR\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'config.ini'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"NUM_RETRIES \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'SETTINGS'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'num_retries'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"DEVICES \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"dict\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DEVICES'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"DATABASE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'database'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DATABASE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'database'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'host'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DATABASE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'host'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DATABASE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'password'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DATABASE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'password'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'port'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DATABASE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'port'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"create_table\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`'''CREATE TABLE IF NOT EXISTS readings(\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      device TEXT,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      timestamp INTEGER,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      temperature REAL,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      humidity INTEGER,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      pressure REAL,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      CO2 INTEGER,\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`      PRIMARY KEY(device, timestamp)\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:\"    )'''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"get_readings\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mac\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" attempt \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"NUM_RETRIES\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" aranet4\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get_current_readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mac\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Attempt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" attempt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'failed, retrying:'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"insert_readings\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"mktime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"datetime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"now\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"timetuple\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"temperature\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"humidity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"pressure\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`co2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Inserting'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'INSERT INTO readings VALUES(%s, %s, %s, %s, %s, %s) ON CONFLICT DO NOTHING'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" psycopg2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"**\"}),\"DATABASE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        cursor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        create_table\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" mac \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" DEVICES\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"items\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            readings \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mac\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" readings \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"is\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                insert_readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" readings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"__main__\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"The database credentials and configuration for the Aranet4 MAC addresses can be found in the \",(0,e.jsx)(n.code,{children:\"config.ini\"}),\" file. Here's an example:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ini\",children:(0,e.jsxs)(n.code,{className:\"language-ini code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token section\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token section-name selector\",children:\"DATABASE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"database\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"postgres\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"host\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"db.<your-id-here.supabase.co\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"user\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"postgres\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"password\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"<your db password here>\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"port\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"5432\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token section\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token section-name selector\",children:\"DEVICES\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"office\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"<your-aranet4-address-here>\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token section\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token section-name selector\",children:\"SETTINGS\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"num_retries\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"2\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The script runs every minute in a cronjob to make sure the measurements are always up to date.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sh\",children:(0,e.jsxs)(n.code,{className:\"language-sh code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"* * * * * /usr/bin/python3 /home/pi/Code/aranet4/load_data.py \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" /home/pi/Code/aranet4/logs/load_data.txt \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token file-descriptor important\",children:\"2\"}),\">\"]}),(0,e.jsx)(n.span,{className:\"token file-descriptor important\",children:\"&1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"9,21\"}),\" * * * /usr/bin/python3 /home/pi/Code/aranet4/cleanup.py \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" /home/pi/Code/aranet4/logs/cleanup.txt \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token file-descriptor important\",children:\"2\"}),\">\"]}),(0,e.jsx)(n.span,{className:\"token file-descriptor important\",children:\"&1\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see I've also included a cleanup script that deletes any entries older than a day. This is to make sure I don't run out of disk space on my free Supabase subscription.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"result\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#result\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Result\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I'll leave out the front-end code in this tutorial as it is quite straightforward. For those interested in how it works it's a combination of a \",(0,e.jsx)(n.a,{href:\"https://github.com/vnglst/koenvangilst.nl/blob/new-design-v7/app/lab/co2/(components)/Co2Monitor.tsx\",children:\"React component\"}),\" and a Next.JS api route that calls the following \",(0,e.jsx)(n.a,{href:\"https://github.com/vnglst/koenvangilst.nl/blob/main/services/aranet.ts\",children:\"service\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Should the levels rise above the recommended threshold of 1000 ppm, don't hesitate to reach out to me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/intent/tweet?text=@vnglst%20Open%20a%20window%20now!\",children:\"Twitter\"}),\" or \",(0,e.jsx)(n.a,{href:\"https://elk.zone/hachyderm.io/@vnglst\",children:\"Mastodon\"}),\" to remind me to ventilate!\"]}),`\n`,(0,e.jsx)(s,{})]})}function d(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(p,{...a})}):p(a)}function A(a,n){throw new Error(\"Expected \"+(n?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return b(E);})();\n;return Component;",
  "readingTime": {
    "text": "3 min read",
    "minutes": 2.895,
    "time": 173700,
    "words": 579
  }
}